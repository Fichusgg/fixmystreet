[%~ FOREACH group IN category_groups ~%]
    [% IF group.name AND include_group_option %]<optgroup label="[% group.name %]">
        [% SET pseudo_category = "group-" _ group.name %]
        <option value="group-[% group.name %]" [% ' selected' IF display_categories.$pseudo_category %]>All [% group.name %]</option>
    [% ELSIF group.name %]
        <optgroup label="[% group.name %]">
    [% END %]
    [%~ FOREACH cat IN group.categories ~%]
        [% INCLUDE category_option %]
    [%~ END ~%]
    [% IF group.name %]</optgroup>[% END %]
[%~ END =%]
